# 最長片道きっぷ問題 (Node.js 実装)

## 概要
与えられた鉄道路線網（`駅ID, 駅ID, 距離` の行の集合）から、  
**同じ駅を2回以上通らない最長経路**を求め、その駅ID列を改行区切りで出力します。

- 入力: 標準入力（複数行、カンマ区切り、浮動小数含む、空白トリム）  
- 出力: 標準出力（最長経路の駅IDを **`\r\n` (CRLF)** 区切りで改行）  

---

## 動作環境
- Node.js **v20 以上**
- npm

`.nvmrc` を用意している場合は以下で環境切り替え可能です。  
```bash
nvm use
````

---

## セットアップ

```bash
# 依存関係をインストール
npm ci
```

---

## 実行方法

### 例: 標準入力から実行

```bash
printf "1, 2, 8.54\n2, 3, 3.11\n3, 1, 2.19\n3, 4, 4\n4, 1, 1.4\n" | node src/index.js
```

### 出力例

```
1
2
3
4
```

> **注意**: 出力の改行コードは `\r\n` です。
> Unix 系のターミナルで表示すると `\n` に見えますが、実際には CRLF が出力されています。

---

## 入出力仕様

### 入力

* 各行: `始点ID, 終点ID, 距離`
* ID: 正の整数
* 距離: 浮動小数点数
* 各数値の前後に任意の空白が入る可能性あり
* 空行は無視される

### 出力

* 最長単純経路に含まれる駅IDを、**1行ごとに1つ**出力
* 改行コードは **`\r\n` (CRLF)**
* 出力の最後にも `\r\n` を付与

---

## スクリプト一覧

```bash
npm run dev      # 開発用ホット実行 (nodemon)
npm run build    # esbuild によるバンドル (dist/index.js)
npm start        # バンドル後の実行
npm test         # 単体テスト (Vitest)
npm run lint     # ESLint チェック
npm run format   # Prettier 整形
npm run check    # Lint + Test + Build 一括確認
```

---

## プロジェクト構成

```
src/
  index.js        # 本体 (solve関数 + CLI)
tests/
  index.test.js   # ユニットテスト (Vitest)
.github/workflows/ci.yml  # 任意 (CI用)
```

---

## アルゴリズム概要

1. 入力を読み込み、有向グラフを隣接リストで構築
2. **DFS (深さ優先探索)** により全ての単純経路を探索
3. 探索中に「訪問済みノード集合」を用いて同じ駅を2回以上通らないよう制御
4. **枝刈り**:

   * グラフ内の辺の重みを降順にソートし、prefix sum を計算
   * 「残りノード数 × 最大辺重み」で見積もれる最大距離が、既知の最長経路より短ければ探索を打ち切る
5. より長い経路を見つけたら更新

   * 距離が同じ場合は最初に見つかった経路を保持（問題文に優先規則はないため）

---

## テスト

Vitest によるユニットテストを用意しています。

```bash
npm test
```

例:

```js
import { solve } from '../src/index.js';

expect(
  solve([
    "1, 2, 8.54",
    "2, 3, 3.11",
    "3, 4, 4"
  ])
).toBe("1\r\n2\r\n3\r\n4");
```

---

## 注意事項

* 問題仕様に従い、**出力改行は CRLF (`\r\n`) 固定**です。
* サイクルを含むグラフでも「同じ点を2回通らない」最長経路を探索します。
* 大規模入力では DFS 探索が膨大になる可能性がありますが、上界計算による枝刈りで現実的な実行時間を確保しています。

